--UC1:
CREATE DATABASE PAYROLL_SERVICE
SELECT * FROM SYS.DATABASES
USE PAYROLL_SERVICE

--UC2:
CREATE TABLE EMPLOYEE_PAYROLL(
ID INT IDENTITY(1,1) PRIMARY KEY NOT NULL,
NAME VARCHAR(25) NOT NULL,
SALARY FLOAT NOT NULL,
START_DATE DATE NOT NULL)

--UC3:
INSERT INTO EMPLOYEE_PAYROLL VALUES('Elavarasu',10000,'10-05-2022')
INSERT INTO EMPLOYEE_PAYROLL VALUES('Nantha',10000,'2022-05-10')
INSERT INTO EMPLOYEE_PAYROLL VALUES('Sudha',15000,'2018-10-22')
INSERT INTO EMPLOYEE_PAYROLL VALUES('Senthil',20000,'2021-10-05')

--UC4:
SELECT * FROM EMPLOYEE_PAYROLL

--UC5:
SELECT NAME,SALARY FROM EMPLOYEE_PAYROLL WHERE NAME = 'Sudha'
SELECT * FROM EMPLOYEE_PAYROLL WHERE START_DATE BETWEEN '2022-01-01' AND CURRENT_TIMESTAMP

--UC6:
ALTER TABLE EMPLOYEE_PAYROLL ADD GENDER VARCHAR(10) NULL
UPDATE EMPLOYEE_PAYROLL SET GENDER = 'M' WHERE NAME = 'Elavarasu'
UPDATE EMPLOYEE_PAYROLL SET GENDER = 'M' WHERE NAME = 'Nantha'
UPDATE EMPLOYEE_PAYROLL SET GENDER = 'F' WHERE NAME = 'Sudha'
UPDATE EMPLOYEE_PAYROLL SET GENDER = 'M' WHERE NAME = 'Senthil'

--UC7:
SELECT GENDER, SUM(SALARY) AS SUM_SALARY FROM EMPLOYEE_PAYROLL GROUP BY GENDER
SELECT GENDER, MIN(SALARY) AS MIN_SALARY FROM EMPLOYEE_PAYROLL GROUP BY GENDER
SELECT GENDER, MAX(SALARY) AS MAX_SALARY FROM EMPLOYEE_PAYROLL GROUP BY GENDER
SELECT GENDER, AVG(SALARY) AS AVG_SALARY FROM EMPLOYEE_PAYROLL GROUP BY GENDER
SELECT GENDER, COUNT(GENDER) AS EMPLOYEE_COUNT FROM EMPLOYEE_PAYROLL GROUP BY GENDER

--UC8:
ALTER TABLE EMPLOYEE_PAYROLL ADD MOBILE DECIMAL NOT NULL DEFAULT(0)
UPDATE EMPLOYEE_PAYROLL SET MOBILE = 9087654321 WHERE NAME = 'Elavarasu'
UPDATE EMPLOYEE_PAYROLL SET MOBILE = 9123456780 WHERE NAME = 'Nantha'
UPDATE EMPLOYEE_PAYROLL SET MOBILE = 9210876543 WHERE NAME = 'Sudha'
UPDATE EMPLOYEE_PAYROLL SET MOBILE = 8907651234 WHERE NAME = 'Senthil'
ALTER TABLE EMPLOYEE_PAYROLL ADD ADDRESS VARCHAR(100) NOT NULL DEFAULT(''), DEPARTMENT VARCHAR(50) NOT NULL DEFAULT('')
UPDATE EMPLOYEE_PAYROLL SET ADDRESS = 'Thevur',DEPARTMENT = 'Production' WHERE NAME = 'Elavarasu'
UPDATE EMPLOYEE_PAYROLL SET ADDRESS = 'Coimbatore',DEPARTMENT = 'Administration' WHERE NAME = 'Nantha'
UPDATE EMPLOYEE_PAYROLL SET ADDRESS = 'Namakkal',DEPARTMENT = 'IT_Support' WHERE NAME = 'Sudha'
UPDATE EMPLOYEE_PAYROLL SET ADDRESS = 'Dindigul',DEPARTMENT = 'Production' WHERE NAME = 'Senthil'

--UC9:
ALTER TABLE EMPLOYEE_PAYROLL ADD BASIC_PAY FLOAT NOT NULL DEFAULT(0), DEDUCTIONS FLOAT NOT NULL DEFAULT(0),
TAXABLE_PAY FLOAT NOT NULL DEFAULT(0), NET_PAY FLOAT NOT NULL DEFAULT(0)
UPDATE EMPLOYEE_PAYROLL SET BASIC_PAY = 10000,DEDUCTIONS = 200,TAXABLE_PAY = 200,NET_PAY = 9600 WHERE ID = 1
UPDATE EMPLOYEE_PAYROLL SET BASIC_PAY = 10000,DEDUCTIONS = 200,TAXABLE_PAY = 200,NET_PAY = 9600 WHERE ID = 2
UPDATE EMPLOYEE_PAYROLL SET BASIC_PAY = 15000,DEDUCTIONS = 200,TAXABLE_PAY = 200,NET_PAY = 14600 WHERE ID = 3
UPDATE EMPLOYEE_PAYROLL SET BASIC_PAY = 20000,DEDUCTIONS = 200,TAXABLE_PAY = 200,NET_PAY = 19600 WHERE ID = 4

--UC10 AND UC11:
INSERT INTO EMPLOYEE_PAYROLL VALUES('Terisa',15000,'2021-01-01','F',9876543210,'Chennai','Sales&Marketing',15000,200,200,14600)
UPDATE EMPLOYEE_PAYROLL SET NAME = 'Terissa' WHERE ID = 5
UPDATE EMPLOYEE_PAYROLL SET DEPARTMENT = 'Sales' WHERE NAME = 'Terissa'
INSERT INTO EMPLOYEE_PAYROLL VALUES('Terissa',15000,'2021-01-01','F',9876543210,'Chennai','Marketing',15000,200,200,14600)

--CREATING COMPANIES TABLE
CREATE TABLE COMPANIES(
COMPANY_ID INT IDENTITY(101,1) PRIMARY KEY NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL)

INSERT INTO COMPANIES VALUES('ABC')
INSERT INTO COMPANIES VALUES('XYZ')

--CREATING EMPLOYEE_DETAILS TABLE
CREATE TABLE EMPLOYEES_DETAILS(
EMP_ID INT IDENTITY(1,1) PRIMARY KEY NOT NULL,
NAME VARCHAR(50) NOT NULL,
GENDER VARCHAR(2) NOT NULL,
PHONE FLOAT NOT NULL,
EMAIL VARCHAR(50) NOT NULL)
ALTER TABLE EMPLOYEES_DETAILS ADD START_DATE DATE NOT NULL
ALTER TABLE EMPLOYEES_DETAILS ADD COMPANY_ID INT NOT NULL DEFAULT(0)

INSERT INTO EMPLOYEES_DETAILS VALUES('Terissa','F',9087654321,'terissa@gmail.com','2018-05-01')
INSERT INTO EMPLOYEES_DETAILS VALUES('Elavarasu','M',9807654321,'elavarasu@gmail.com','2022-05-10')
INSERT INTO EMPLOYEES_DETAILS VALUES('Nantha','M',9123456780,'nantha@gmail.com','2022-05-10')
INSERT INTO EMPLOYEES_DETAILS VALUES('Senthil','M',8907651234,'senthil@gmail.com','2021-10-05')
UPDATE EMPLOYEES_DETAILS SET COMPANY_ID = 101
UPDATE EMPLOYEES_DETAILS SET START_DATE = '2022-05-10' WHERE NAME = 'Elavarasu'

--CREATING DEPARTMENT_DETAILS TABLE
CREATE TABLE DEPARTMENT_DETAILS(
DEPT_ID INT IDENTITY(11,1) PRIMARY KEY NOT NULL,
DEPT_NAME VARCHAR(25) NOT NULL)

INSERT INTO DEPARTMENT_DETAILS VALUES('Administration'),('Sales'),('Marketing'),('Production')

--CREATING EMPLOYEE_ADDRESS TABLE
CREATE TABLE EMP_ADDRESS(
NAME VARCHAR(50) PRIMARY KEY NOT NULL,
ADDRESS VARCHAR(25) NOT NULL,
CITY VARCHAR(25) NOT NULL,
STATE VARCHAR(25) NOT NULL,
ZIP_CODE INT NOT NULL)

INSERT INTO EMP_ADDRESS VALUES('Terissa','15C','Chennai','Tamil Nadu',600001)
INSERT INTO EMP_ADDRESS VALUES('Elavarasu','11A','Komarapalayam','Tamil Nadu',654321)
INSERT INTO EMP_ADDRESS VALUES('Nantha','12D','Coimbatore','Tamil Nadu',645231)
INSERT INTO EMP_ADDRESS VALUES('Senthil','14C','Dindigul','Tamil Nadu',632154)

--CREATING EMPLOYEE_SALARY TABLE
CREATE TABLE EMP_SALARY(
EMP_ID INT IDENTITY(1,1) PRIMARY KEY NOT NULL,
NAME VARCHAR(50) NOT NULL,
BASIC_PAY FLOAT NOT NULL,
DEDUCTIONS FLOAT NOT NULL,
TAXABLE_PAY FLOAT NOT NULL,
INCOME_TAX FLOAT NOT NULL,
NET_PAY FLOAT NOT NULL)

INSERT INTO EMP_SALARY VALUES('Terissa',50000,1000,1000,2000,46000)
INSERT INTO EMP_SALARY VALUES('Elavarasu',30000,1000,1000,2000,26000)
INSERT INTO EMP_SALARY VALUES('Nantha',40000,1000,1000,2000,36000)
INSERT INTO EMP_SALARY VALUES('Senthil',50000,1000,1000,2000,46000)

--CREATING EMPLOYEE_DEPARTMENT TABLE
CREATE TABLE EMP_DEPARTMENT(
EMP_ID INT NOT NULL,
EMP_NAME VARCHAR(25) NOT NULL,
DEPT_ID INT NOT NULL,
DEPT_NAME VARCHAR(25) NOT NULL)

INSERT INTO EMP_DEPARTMENT VALUES(1,'Terissa',12,'Sales'),(1,'Terissa',13,'Marketing'),(2,'Elavarasu',14,'Production'),(3,'Nantha',14,'Production'),(4,'Senthil',11,'Administration')

--ADDING CONSTRAINTS TO THE TABLES
ALTER TABLE EMPLOYEES_DETAILS ADD CONSTRAINT FK_COMP_ID FOREIGN KEY(COMPANY_ID) REFERENCES COMPANIES(COMPANY_ID)
ALTER TABLE EMP_SALARY ADD CONSTRAINT FK_EMP_ID FOREIGN KEY(EMP_ID) REFERENCES EMPLOYEES_DETAILS(EMP_ID)
ALTER TABLE EMPLOYEES_DETAILS ADD CONSTRAINT FK_NAME FOREIGN KEY(NAME) REFERENCES EMP_ADDRESS(NAME)
ALTER TABLE EMP_DEPARTMENT ADD CONSTRAINT FK_EMP_DEPT_ID FOREIGN KEY(EMP_ID) REFERENCES EMPLOYEES_DETAILS(EMP_ID)
ALTER TABLE EMP_DEPARTMENT ADD CONSTRAINT FK_DEPT_ID FOREIGN KEY(DEPT_ID) REFERENCES DEPARTMENT_DETAILS(DEPT_ID)

SELECT GENDER,SUM(BASIC_PAY) AS SALARY_SUM FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,MIN(BASIC_PAY) AS MIN_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,MAX(BASIC_PAY) AS MAX_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,AVG(BASIC_PAY) AS AVG_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,COUNT(GENDER) AS EMP_COUNT FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER


